webpackJsonp([4],{"6Tc7":function(t,e,n){"use strict";var i={name:"date-picker",data:function(){return{tempYear:this.date.year,tempMonth:this.date.month,tempDay:this.date.day,posY:0}},props:{date:{type:Object,default:function(){return{year:1970,month:1,day:1}}}},methods:{setYear:function(t){t.preventDefault(),t.stopPropagation(),this.tempYear-=.06*t.deltaY;var e=Math.round(this.tempYear),n=Math.round(this.tempMonth),i=Math.round(this.tempDay);(e%4==0&&e%100!=0||e%400==0)&&2===n&&29===i&&(this.tempDay=28)},setYear2:function(t){if(this.$root.adapt)switch(t){case 0:(this.tempYear%4==0&&this.tempYear%100!=0||this.tempYear%400==0)&&2===this.tempMonth&&29===this.tempDay&&(this.tempDay=28),this.tempYear--;break;case 2:(this.tempYear%4==0&&this.tempYear%100!=0||this.tempYear%400==0)&&2===this.tempMonth&&29===this.tempDay&&(this.tempDay=28),this.tempYear++}},setMonth:function(t){t.preventDefault(),t.stopPropagation(),this.tempMonth-=.06*t.deltaY;var e=Math.round(this.tempYear),n=Math.round(this.tempMonth),i=Math.round(this.tempDay),s=this.getDaysInMonth(e,n);i>s&&(this.tempDay=s),n<1?(this.tempYear--,this.tempMonth=12):n>12&&(i===this.getDaysInMonth(e,12)&&(this.tempDay=1),this.tempYear++,this.tempMonth=1)},setMonth2:function(t){if(this.$root.adapt)switch(t){case 0:this.tempMonth--,this.tempDay>this.getDaysInMonth(this.year,this.tempMonth)&&(this.tempDay=this.getDaysInMonth(this.year,this.tempMonth)),0===this.tempMonth&&(this.tempYear--,this.tempMonth=12);break;case 2:this.tempMonth++,this.tempDay>this.getDaysInMonth(this.year,this.tempMonth)&&(this.tempDay=this.getDaysInMonth(this.year,this.tempMonth)),13===this.tempMonth&&(this.tempDay===this.getDaysInMonth(this.year,12)&&(this.tempDay=1),this.tempYear++,this.tempMonth=1)}},setDay:function(t){t.preventDefault(),t.stopPropagation(),this.tempDay-=.06*t.deltaY;var e=Math.round(this.tempYear),n=Math.round(this.tempMonth),i=Math.round(this.tempDay);i<1?(1===n?(this.tempYear--,this.tempMonth=12):this.tempMonth--,this.tempDay=this.getDaysInMonth(Math.round(this.tempYear),Math.round(this.tempMonth))):i>this.getDaysInMonth(e,n)&&(this.tempDay=1,12===n?(this.tempYear++,this.tempMonth=1):this.tempMonth++)},setDay2:function(t){if(this.$root.adapt)switch(t){case 0:this.tempDay--,0===this.tempDay&&(1===this.tempMonth?(this.tempYear--,this.tempMonth=12):this.tempMonth--,this.tempDay=this.getDaysInMonth(this.tempYear,this.tempMonth));break;case 2:this.tempDay++,this.tempDay>this.getDaysInMonth(this.tempYear,this.tempMonth)&&(this.tempDay=1,12===this.tempMonth?(this.tempYear++,this.tempMonth=1):this.tempMonth++)}},getDaysInMonth:function(t,e){return new Date(t,e,0).getDate()},input:function(){var t={year:Math.round(this.tempYear),month:Math.round(this.tempMonth),day:Math.round(this.tempDay)};this.$emit("pick",t)},cancelInput:function(){this.$emit("hide")}},computed:{renderYear:function(){for(var t=[],e=Math.round(this.tempYear),n=e-1;n<=e+1;n++)t.push(n);return t},renderMonth:function(){for(var t=[],e=Math.round(this.tempMonth),n=e-1;n<=e+1;n++)n<1?t.push(12):n>12?t.push(1):t.push(n);return t},renderDay:function(){for(var t=[],e=Math.round(this.tempYear),n=Math.round(this.tempMonth),i=Math.round(this.tempDay),s=i-1;s<=i+1;s++)s<1?1===n?t.push(this.getDaysInMonth(e-1,12)):t.push(this.getDaysInMonth(e,n-1)):s>this.getDaysInMonth(e,n)?t.push(1):t.push(s);return t}}},s={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"picker",style:this.$root.modalHeight(0)},[n("p",[t._v("请选择时间")]),t._v(" "),n("div",{staticClass:"date-wrapper"},[n("div",{directives:[{name:"finger",rawName:"v-finger:press-move",value:t.setYear,expression:"setYear",arg:"press-move"}],staticClass:"year date pointer"},[t._l(t.renderYear,function(e,i){return n("div",{key:i,on:{click:function(e){t.setYear2(i)}}},[n("p",[t._v(t._s(e)+" 年")])])}),t._v(" "),n("div",{staticClass:"center-line"})],2),t._v(" "),n("div",{directives:[{name:"finger",rawName:"v-finger:press-move",value:t.setMonth,expression:"setMonth",arg:"press-move"}],staticClass:"month date pointer"},[t._l(t.renderMonth,function(e,i){return n("div",{key:i,on:{click:function(e){t.setMonth2(i)}}},[n("p",[t._v(t._s(e)+" 月")])])}),t._v(" "),n("div",{staticClass:"center-line"})],2),t._v(" "),n("div",{directives:[{name:"finger",rawName:"v-finger:press-move",value:t.setDay,expression:"setDay",arg:"press-move"}],staticClass:"day date pointer"},[t._l(t.renderDay,function(e,i){return n("div",{key:i,on:{click:function(e){t.setDay2(i)}}},[n("p",[t._v(t._s(e)+" 日")])])}),t._v(" "),n("div",{staticClass:"center-line"})],2)]),t._v(" "),n("div",{staticClass:"choices"},[n("div",{staticClass:"modal-cancel",on:{click:t.cancelInput}},[t._v("取消")]),t._v(" "),n("div",{staticClass:"modal-submit",on:{click:t.input}},[t._v("确定")])])])},staticRenderFns:[]};var a=n("VU/8")(i,s,!1,function(t){n("qN3m")},"data-v-7bb837e0",null);e.a=a.exports},afnX:function(t,e){},qN3m:function(t,e){},weal:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("7t+N"),s=n.n(i),a={name:"re-application",data:function(){return{applicationStatus:!1,reimbursement:[{name:"起止日期",id:"expense_date",type:"text",error:!1},{name:"费用类型",id:"expense_type",type:"text",error:!1},{name:"费用描述",id:"expense_description",type:"text",error:!1},{name:"发票索引",id:"receipt_reference",type:"text",error:!1},{name:"发票金额",id:"receipt_amount",type:"text",error:!1}],inputIndex:-1,date:{year:0,month:0,day:0},typeList:["市内交通费","在途费用","差旅补贴"],typeIndex:-1,tempTypeIndex:-1,number:0}},methods:{application:function(){s.a.ajax({async:!1,url:"/expense_application/",type:"POST",data:{expense_date:s()("#expense_date").val(),expense_description:s()("#expense_description").val(),expense_type:s()("#expense_type").val(),receipt_reference:s()("#receipt_reference").val(),receipt_currency:"CNY",receipt_amount:s()("#receipt_amount").val(),exchange_rate:1,converted_amount:s()("#converted_amount").val(),csrfmiddlewaretoken:csrf_token},success:function(t){alert(t)}})},setValue:function(t){var e;switch(this.inputIndex=t,t>1&&s()(".money-item input").eq(t).focus(),t){case 0:s()(".money-item input").eq(t).blur(),this.$root.eventHub.$emit("prompt");break;case 1:s()(".money-item input").eq(t).blur(),""===s()(".money-item input").eq(1).val()&&(this.typeIndex=1),this.tempTypeIndex=this.typeIndex,this.$root.eventHub.$emit("prompt");break;case 2:this.$root.adapt||(e=s()("#main").height()+174,s()("#app").animate({scrollTop:e},400));break;case 3:this.$root.adapt||(e=s()("#main").height()+232,s()("#app").animate({scrollTop:e},400));break;case 4:this.$root.adapt||(e=s()("#main").height()+290,s()("#app").animate({scrollTop:e},400)),""!==event.target.value&&s()(".money-item input").eq(4).val(this.number)}},setType:function(t){switch(t.preventDefault(),t.stopPropagation(),t||(t=window.event),t.type){case"touchstart":this.posY=t.targetTouches[0].pageY;break;case"touchmove":var e=t.targetTouches[0].pageY-this.posY;e>40?(this.posY=t.targetTouches[0].pageY,this.tempTypeIndex>0?this.tempTypeIndex--:this.tempTypeIndex=0):e<-40&&(this.posY=t.targetTouches[0].pageY,this.tempTypeIndex<2?this.tempTypeIndex++:this.tempTypeIndex=2)}},setType2:function(t){if(this.$root.adapt)switch(t){case 0:this.tempTypeIndex>0&&this.tempTypeIndex--;break;case 2:this.tempTypeIndex<2&&this.tempTypeIndex++}},inputValue:function(t){switch(t){case 4:this.number=event.target.value}},showValue:function(t){switch(""!==event.target.value&&(this.reimbursement[t].error=!1),t){case 2:case 3:this.inputIndex=-1;break;case 4:this.inputIndex=-1,""===event.target.value&&(this.number=0),event.target.value=this.number+" 元"}},input:function(){this.reimbursement[this.inputIndex].error=!1,this.typeIndex=this.tempTypeIndex,s()(".money-item input").eq(1).val(this.typeList[this.typeIndex]),this.cancelInput()},inputDate:function(t){this.date=t,s()(".money-item input").eq(0).val(this.date.year+"年"+this.date.month+"月"+this.date.day+"日"),this.cancelInput()},cancelInput:function(){this.$root.eventHub.$emit("prompt"),this.hideModal()},hideModal:function(){this.inputIndex=-1},renderPlace:function(t){switch(t){case 0:return"请输入活动日期";case 1:return"请选择费用类型";case 2:case 3:return"必填";case 4:return"例: 30元"}},submit:function(){for(var t=!0,e=s()(".money-item input"),n=0;n<e.length;n++)""===e[n].value&&(this.reimbursement[n].error=!0,t=!1);if(t){var i=this.date.year+"."+this.date.month+"."+this.date.day,a=(1*this.number).toFixed(2),r=this;s.a.ajax({async:!1,url:"/expense_application/",type:"POST",data:{expense_date:i,expense_description:s()(".money-item input").eq(2).val(),expense_type:s()(".money-item input").eq(1).val(),receipt_reference:s()(".money-item input").eq(3).val(),receipt_currency:"CNY",receipt_amount:a,exchange_rate:1,converted_amount:a,csrfmiddlewaretoken:csrf_token},success:function(t){var e;"success"===t?(e={text:"成功提交报销申请！",duration:1e3},r.$root.eventHub.$emit("showPrompt",e),r.$router.push({path:"/user/reimbursement"})):(e={text:"提交失败！",duration:1e3},r.$root.eventHub.$emit("showPrompt",e))}})}else{this.$root.eventHub.$emit("showPrompt",{text:"请输入完整的报销信息！",duration:1200})}}},computed:{renderType:function(){var t,e=[];switch(this.tempTypeIndex){case 0:e.push(""),e.push(this.typeList[0]),e.push(this.typeList[1]);break;case 1:for(t=0;t<3;t++)e.push(this.typeList[t]);break;case 2:e.push(this.typeList[1]),e.push(this.typeList[2]),e.push("")}return e}},components:{DatePicker:n("6Tc7").a},mounted:function(){var t=this;this.applicationStatus=!0,this.$root.getCurrentDate(this.date),this.$root.eventHub.$on("cancelPrompt",function(){-1!==t.inputIndex&&t.hideModal()})}},r={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"reapplication"}},[n("transition",{attrs:{name:"funcList"}},[t.applicationStatus?n("div",{staticClass:"func-operation"},[t._l(t.reimbursement,function(e,i){return n("div",{key:i,staticClass:"money-item",class:{error:e.error,active:t.inputIndex===i},on:{click:function(e){t.setValue(i)}}},[n("p",{staticClass:"left"},[t._v(t._s(e.name))]),t._v(" "),n("input",{attrs:{type:e.type,placeholder:t.renderPlace(i)},on:{input:function(e){t.inputValue(i)},blur:function(e){t.showValue(i)}}})])}),t._v(" "),n("div",{staticClass:"pointer",attrs:{id:"submit"},on:{click:t.submit}},[t._v("提交")])],2):t._e()]),t._v(" "),n("transition",{attrs:{name:"modal"}},[0===t.inputIndex?n("DatePicker",{attrs:{date:t.date},on:{hide:t.cancelInput,pick:t.inputDate}}):t._e()],1),t._v(" "),n("transition",{attrs:{name:"modal"}},[1===t.inputIndex?n("div",{staticClass:"picker",style:this.$root.modalHeight(1)},[n("p",[t._v("请选择类型")]),t._v(" "),n("div",{staticClass:"type-wrapper"},[n("div",{staticClass:"type pointer",on:{touchstart:t.setType,touchmove:t.setType,touchend:t.setType}},[t._l(t.renderType,function(e,i){return n("div",{key:i,on:{click:function(e){t.setType2(i)}}},[n("p",[t._v(t._s(e))])])}),t._v(" "),n("div",{staticClass:"center-line"})],2)]),t._v(" "),n("div",{staticClass:"choices"},[n("div",{staticClass:"modal-cancel",on:{click:t.cancelInput}},[t._v("取消")]),t._v(" "),n("div",{staticClass:"modal-submit",on:{click:t.input}},[t._v("确定")])])]):t._e()])],1)},staticRenderFns:[]};var p=n("VU/8")(a,r,!1,function(t){n("afnX")},"data-v-35803590",null);e.default=p.exports}});
//# sourceMappingURL=4.6b582f5df0d216da8cae.js.map